<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jeopardy Game - LIVE Function Testing</title>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 20px;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: white;
      width: 100%;
      min-height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    .test-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #FFD700;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }

    .critical-info {
      text-align: center;
      background: rgba(255, 0, 0, 0.2);
      border: 3px solid #ff0000;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
    }

    .critical-info h2 {
      color: #ff6666;
      margin-top: 0;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .status-card {
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 10px;
      border: 3px solid #FFD700;
    }

    .status-card h3 {
      color: #FFD700;
      margin-top: 0;
      font-size: 1.3em;
      border-bottom: 2px solid #FFD700;
      padding-bottom: 10px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      padding: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
    }

    .status-label {
      color: #FFA500;
      font-weight: bold;
    }

    .status-value {
      color: #00ff00;
      font-family: monospace;
      font-weight: bold;
    }

    .status-value.error {
      color: #ff6666;
    }

    .test-section {
      background: rgba(0, 0, 0, 0.4);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      border: 3px solid #FFD700;
    }

    .test-section h2 {
      color: #FFD700;
      font-size: 1.8em;
      margin-top: 0;
      margin-bottom: 20px;
      border-bottom: 2px solid #FFD700;
      padding-bottom: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-btn {
      background: linear-gradient(135deg, #0f4d2e 0%, #1a5c3a 100%);
      color: #FFD700;
      border: 3px solid #FFD700;
      padding: 15px 20px;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
      position: relative;
    }

    .test-btn:hover {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      color: #000;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
    }

    .test-btn.success {
      border-color: #00ff00;
      background: linear-gradient(135deg, #0a3d1a 0%, #0f5a2a 100%);
    }

    .test-btn.error {
      border-color: #ff0000;
      background: linear-gradient(135deg, #3d0a0a 0%, #5a0f0f 100%);
    }

    .test-btn.warning {
      background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
    }

    .test-btn .status-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.2em;
    }

    .test-log {
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #00ff00;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.9em;
      margin-top: 20px;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 5px;
      border-left: 3px solid #00ff00;
      padding-left: 10px;
    }

    .log-entry.error {
      border-left-color: #ff0000;
      color: #ff6666;
    }

    .log-entry.success {
      border-left-color: #00ff00;
      color: #66ff66;
    }

    .log-entry.warning {
      border-left-color: #FFA500;
      color: #FFD700;
    }

    .log-entry.info {
      border-left-color: #4499ff;
      color: #88ccff;
    }

    .input-group {
      margin: 15px 0;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
    }

    .input-group label {
      display: block;
      color: #FFD700;
      margin-bottom: 8px;
      font-weight: bold;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 10px;
      border: 2px solid #FFD700;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.9);
      font-size: 1em;
    }

    .btn-clear {
      background: #8B0000;
      color: white;
      border: 2px solid #FF6B6B;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1em;
      margin: 10px 5px;
    }

    .btn-clear:hover {
      background: #DC143C;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
      color: #000;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 1.2em;
      font-weight: bold;
      box-shadow: 0 5px 20px rgba(0, 255, 0, 0.5);
      animation: slideIn 0.3s ease-out;
      z-index: 10000;
      max-width: 400px;
    }

    .notification.error {
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      color: white;
      box-shadow: 0 5px 20px rgba(255, 0, 0, 0.5);
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .team-scores-display {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin: 20px 0;
    }

    .team-score-card {
      background: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #FFD700;
      text-align: center;
    }

    .team-score-card.current {
      border-color: #ff0000;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
    }

    .team-score-card .team-name {
      color: #FFD700;
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 8px;
    }

    .team-score-card .team-score {
      color: #00ff00;
      font-size: 1.8em;
      font-weight: bold;
    }

    .team-score-card .team-score.negative {
      color: #ff6666;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="test-container">
   <h1>ğŸ„ Jeopardy Game - LIVE Function Testing ğŸ…</h1>
   <div class="critical-info">
    <h2>âš ï¸ IMPORTANT TESTING INSTRUCTIONS âš ï¸</h2>
    <p style="font-size: 1.2em; margin: 10px 0;"><strong>This is a LIVE testing interface for the actual game!</strong></p>
    <p style="font-size: 1em;">1ï¸âƒ£ First, initialize the SDK and create game state (if not already done)<br>
      2ï¸âƒ£ Test functions will modify the REAL game database<br>
      3ï¸âƒ£ Open the main game in another tab to see changes in real-time<br>
      4ï¸âƒ£ Use "Reset Game" at bottom to start fresh</p>
   </div><!-- Real-Time Status -->
   <div class="status-grid">
    <div class="status-card">
     <h3>ğŸ”Œ Connection Status</h3>
     <div class="status-item"><span class="status-label">SDK:</span> <span class="status-value" id="sdk-status">âŒ Not Connected</span>
     </div>
     <div class="status-item"><span class="status-label">Game Data:</span> <span class="status-value" id="game-status">âŒ Not Loaded</span>
     </div>
     <div class="status-item"><span class="status-label">Last Update:</span> <span class="status-value" id="last-update">Never</span>
     </div>
    </div>
    <div class="status-card">
     <h3>ğŸ® Game State</h3>
     <div class="status-item"><span class="status-label">Current Team:</span> <span class="status-value" id="current-team">-</span>
     </div>
     <div class="status-item"><span class="status-label">Questions Used:</span> <span class="status-value" id="questions-used">0 / 20</span>
     </div>
     <div class="status-item"><span class="status-label">Multiplier:</span> <span class="status-value" id="multiplier">1x</span>
     </div>
    </div>
    <div class="status-card">
     <h3>ğŸ”” Active States</h3>
     <div class="status-item"><span class="status-label">Buzzer:</span> <span class="status-value" id="buzzer-status">âŒ Inactive</span>
     </div>
     <div class="status-item"><span class="status-label">Active Question:</span> <span class="status-value" id="active-question">None</span>
     </div>
     <div class="status-item"><span class="status-label">Answer Revealed:</span> <span class="status-value" id="answer-revealed">No</span>
     </div>
    </div>
   </div><!-- Team Scores Display -->
   <div class="test-section">
    <h2>ğŸ“Š Live Team Scores</h2>
    <div class="team-scores-display" id="team-scores-display"><!-- Populated dynamically -->
    </div>
   </div><!-- Setup & Initialization -->
   <div class="test-section">
    <h2>1ï¸âƒ£ Setup &amp; Initialization</h2>
    <div class="test-grid"><button class="test-btn" onclick="testSDKInit()" id="btn-sdk-init"> <span class="status-indicator">â³</span> ğŸ”Œ Initialize SDK </button> <button class="test-btn" onclick="testCreateGame()" id="btn-create-game"> <span class="status-indicator">â³</span> ğŸ® Create New Game </button> <button class="test-btn" onclick="testLoadGame()" id="btn-load-game"> <span class="status-indicator">â³</span> ğŸ“¥ Load Game State </button> <button class="test-btn warning" onclick="testResetGame()" id="btn-reset-game"> <span class="status-indicator">âš ï¸</span> ğŸ”„ Reset Game (DELETE) </button>
    </div>
   </div><!-- Team Management -->
   <div class="test-section">
    <h2>2ï¸âƒ£ Team Management</h2>
    <div class="input-group"><label>Select Team for Testing:</label> <select id="test-team-select"> <option value="1">Team 1</option> <option value="2">Team 2</option> <option value="3">Team 3</option> <option value="4">Team 4</option> <option value="5">Team 5</option> </select>
    </div>
    <div class="test-grid"><button class="test-btn" onclick="testUpdateName()" id="btn-update-name"> <span class="status-indicator">âœï¸</span> âœï¸ Update Team Name </button> <button class="test-btn" onclick="testChangeAvatar()" id="btn-change-avatar"> <span class="status-indicator">ğŸ¨</span> ğŸ¨ Change Avatar </button> <button class="test-btn" onclick="testSetCurrent()" id="btn-set-current"> <span class="status-indicator">ğŸ‘‰</span> ğŸ‘‰ Set as Current </button> <button class="test-btn" onclick="testAddPoints()" id="btn-add-points"> <span class="status-indicator">â•</span> â• Add 200 Points </button> <button class="test-btn" onclick="testSubtractPoints()" id="btn-subtract-points"> <span class="status-indicator">â–</span> â– Subtract 200 Points </button> <button class="test-btn" onclick="testNegativeScore()" id="btn-negative"> <span class="status-indicator">ğŸ“‰</span> ğŸ“‰ Set to -500 </button>
    </div>
   </div><!-- Question System -->
   <div class="test-section">
    <h2>3ï¸âƒ£ Question System</h2>
    <div class="input-group"><label>Category:</label> <select id="test-category"> <option value="0">Types of Hearing Loss</option> <option value="1">External Otitis</option> <option value="2">Otitis Media</option> <option value="3">Tinnitus &amp; Vertigo</option> </select>
    </div>
    <div class="input-group"><label>Value:</label> <select id="test-value"> <option value="100">$100</option> <option value="200">$200</option> <option value="300">$300</option> <option value="400">$400</option> <option value="500">$500</option> </select>
    </div>
    <div class="test-grid"><button class="test-btn" onclick="testShowQuestion()" id="btn-show-question"> <span class="status-indicator">â“</span> â“ Show Question </button> <button class="test-btn" onclick="testRevealAnswer()" id="btn-reveal-answer"> <span class="status-indicator">ğŸ‘ï¸</span> ğŸ‘ï¸ Reveal Answer </button> <button class="test-btn" onclick="testMarkCorrect()" id="btn-mark-correct"> <span class="status-indicator">âœ…</span> âœ… Mark Correct </button> <button class="test-btn" onclick="testMarkWrong()" id="btn-mark-wrong"> <span class="status-indicator">âŒ</span> âŒ Mark Wrong </button> <button class="test-btn" onclick="testReturnBoard()" id="btn-return-board"> <span class="status-indicator">ğŸ”™</span> ğŸ”™ Return to Board </button> <button class="test-btn" onclick="testUseAllQuestions()" id="btn-use-all"> <span class="status-indicator">ğŸ“‹</span> ğŸ“‹ Mark All Used </button>
    </div>
   </div><!-- Multiplier & Power-ups -->
   <div class="test-section">
    <h2>4ï¸âƒ£ Multipliers &amp; Power-ups</h2>
    <div class="test-grid"><button class="test-btn" onclick="testDoubleNext()" id="btn-double"> <span class="status-indicator">âš¡</span> âš¡ Double Next (2x) </button> <button class="test-btn" onclick="testTripleNext()" id="btn-triple"> <span class="status-indicator">âš¡</span> âš¡ Triple Next (3x) </button> <button class="test-btn" onclick="testGiveCandy()" id="btn-give-candy"> <span class="status-indicator">ğŸ¬</span> ğŸ¬ Give Candy Cane </button> <button class="test-btn" onclick="testGiveOrnament()" id="btn-give-ornament"> <span class="status-indicator">ğŸ„</span> ğŸ„ Give Ornament </button> <button class="test-btn" onclick="testUseCandy()" id="btn-use-candy"> <span class="status-indicator">ğŸ¬</span> ğŸ¬ Use Candy (+50) </button> <button class="test-btn" onclick="testUseOrnament()" id="btn-use-ornament"> <span class="status-indicator">ğŸ„</span> ğŸ„ Use Ornament (2x) </button>
    </div>
   </div><!-- Buzzer System -->
   <div class="test-section">
    <h2>5ï¸âƒ£ Buzzer System</h2>
    <div class="test-grid"><button class="test-btn" onclick="testEnableBuzzer()" id="btn-enable-buzzer"> <span class="status-indicator">ğŸ””</span> ğŸ”” Enable Buzzer </button> <button class="test-btn" onclick="testDisableBuzzer()" id="btn-disable-buzzer"> <span class="status-indicator">ğŸ”•</span> ğŸ”• Disable Buzzer </button> <button class="test-btn" onclick="testBuzzIn()" id="btn-buzz-in"> <span class="status-indicator">âš¡</span> âš¡ Team Buzzes In </button> <button class="test-btn" onclick="testClearBuzzer()" id="btn-clear-buzzer"> <span class="status-indicator">ğŸ§¹</span> ğŸ§¹ Clear Buzzer </button>
    </div>
   </div><!-- Chaos Events -->
   <div class="test-section">
    <h2>6ï¸âƒ£ Chaos Events</h2>
    <div class="test-grid"><button class="test-btn warning" onclick="testSantaShuffle()" id="btn-santa"> <span class="status-indicator">ğŸ…</span> ğŸ… Santa Shuffle </button> <button class="test-btn warning" onclick="testGingerbread()" id="btn-gingerbread"> <span class="status-indicator">ğŸª</span> ğŸª Gingerbread (-100 all) </button> <button class="test-btn warning" onclick="testStockingSteal()" id="btn-stocking"> <span class="status-indicator">ğŸ§¦</span> ğŸ§¦ Stocking Steal </button> <button class="test-btn warning" onclick="testSwapScores()" id="btn-swap"> <span class="status-indicator">ğŸ”„</span> ğŸ”„ Swap Team Scores </button>
    </div>
   </div><!-- Stress Tests -->
   <div class="test-section">
    <h2>7ï¸âƒ£ Stress Tests</h2>
    <div class="test-grid"><button class="test-btn" onclick="testRapidUpdates()" id="btn-rapid"> <span class="status-indicator">âš¡</span> âš¡ Rapid Updates (10x) </button> <button class="test-btn" onclick="testAllNegative()" id="btn-all-negative"> <span class="status-indicator">ğŸ“‰</span> ğŸ“‰ All Teams Negative </button> <button class="test-btn" onclick="testMaxScores()" id="btn-max-scores"> <span class="status-indicator">ğŸ“ˆ</span> ğŸ“ˆ Max Scores (9999) </button> <button class="test-btn" onclick="testStateFlood()" id="btn-flood"> <span class="status-indicator">ğŸŒŠ</span> ğŸŒŠ State Change Flood </button>
    </div>
   </div><!-- Test Log -->
   <div class="test-log" id="test-log">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"><strong style="color: #FFD700; font-size: 1.2em;">ğŸ“ Test Log</strong> <button class="btn-clear" onclick="clearLog()">Clear Log</button>
    </div>
    <div id="log-entries">
     <div class="log-entry info">
      [READY] Test suite loaded. Initialize SDK to begin testing.
     </div>
    </div>
   </div>
  </div>
  <script>
  // ===== GAME STATE =====
  let gameState = null;
  let sdkInitialized = false;
  let updateInterval = null;

  // ===== DATA SDK HANDLER =====
  const dataHandler = {
    onDataChanged(data) {
      if (data.length > 0) {
        gameState = data[0];
        updateAllDisplays();
        log('ğŸ“¡ Game state updated from database', 'success');
        document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
      }
    }
  };

  // ===== HELPER FUNCTIONS =====
  function log(message, type = 'info') {
    const logEntries = document.getElementById('log-entries');
    const entry = document.createElement('div');
    entry.className = `log-entry ${type}`;
    const timestamp = new Date().toLocaleTimeString();
    entry.textContent = `[${timestamp}] ${message}`;
    logEntries.insertBefore(entry, logEntries.firstChild);
    
    // Keep only last 50 entries
    while (logEntries.children.length > 50) {
      logEntries.removeChild(logEntries.lastChild);
    }
  }

  function clearLog() {
    document.getElementById('log-entries').innerHTML = 
      '<div class="log-entry info">[READY] Log cleared. Continue testing...</div>';
  }

  function notify(message, isError = false) {
    const notification = document.createElement('div');
    notification.className = 'notification' + (isError ? ' error' : '');
    notification.textContent = (isError ? 'âŒ ' : 'âœ… ') + message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }

  function updateButtonStatus(btnId, status) {
    const btn = document.getElementById(btnId);
    if (!btn) return;
    
    btn.classList.remove('success', 'error');
    
    if (status === 'success') {
      btn.classList.add('success');
      btn.querySelector('.status-indicator').textContent = 'âœ…';
    } else if (status === 'error') {
      btn.classList.add('error');
      btn.querySelector('.status-indicator').textContent = 'âŒ';
    }
  }

  function parseGameState() {
    if (!gameState) return null;
    
    return {
      usedQuestions: gameState.used_questions ? gameState.used_questions.split(',').filter(x => x).map(Number) : [],
      teamScores: gameState.team_scores.split(',').map(Number),
      teamNames: gameState.team_names.split(','),
      teamAvatars: gameState.team_avatars.split(','),
      teamPowerups: gameState.team_powerups.split(',').map(p => {
        const [candy, ornament] = p.split('-').map(Number);
        return { candy, ornament };
      }),
      currentTeam: Number(gameState.current_team),
      nextMultiplier: Number(gameState.next_multiplier),
      buzzerActive: gameState.buzzer_active === 'true',
      buzzerWinner: gameState.buzzer_winner || '',
      activeQuestion: gameState.active_question || '',
      answerRevealed: gameState.answer_revealed === 'true'
    };
  }

  async function updateGameState(updates) {
    if (!gameState) {
      log('âŒ Cannot update: no game state loaded', 'error');
      notify('No game state loaded!', true);
      return false;
    }
    
    const updatedState = { ...gameState, ...updates };
    const result = await window.dataSdk.update(updatedState);
    
    if (result.isOk) {
      gameState = updatedState;
      updateAllDisplays();
      return true;
    } else {
      log(`âŒ Update failed: ${result.error}`, 'error');
      notify('Update failed!', true);
      return false;
    }
  }

  function updateAllDisplays() {
    if (!gameState) {
      document.getElementById('game-status').textContent = 'âŒ Not Loaded';
      document.getElementById('game-status').classList.add('error');
      return;
    }

    const state = parseGameState();
    
    // Connection status
    document.getElementById('sdk-status').textContent = 'âœ… Connected';
    document.getElementById('sdk-status').classList.remove('error');
    document.getElementById('game-status').textContent = 'âœ… Loaded';
    document.getElementById('game-status').classList.remove('error');
    
    // Game state
    document.getElementById('current-team').textContent = 
      `Team ${state.currentTeam} (${state.teamNames[state.currentTeam - 1]})`;
    document.getElementById('questions-used').textContent = 
      `${state.usedQuestions.length} / 20`;
    document.getElementById('multiplier').textContent = 
      `${state.nextMultiplier}x`;
    
    // Active states
    document.getElementById('buzzer-status').textContent = 
      state.buzzerActive ? 'âœ… Active' : 'âŒ Inactive';
    document.getElementById('active-question').textContent = 
      state.activeQuestion ? 'Yes (synced to teams)' : 'None';
    document.getElementById('answer-revealed').textContent = 
      state.answerRevealed ? 'Yes' : 'No';
    
    // Team scores
    updateTeamScoresDisplay(state);
  }

  function updateTeamScoresDisplay(state) {
    const container = document.getElementById('team-scores-display');
    container.innerHTML = '';
    
    for (let i = 0; i < 5; i++) {
      const card = document.createElement('div');
      card.className = 'team-score-card' + (i + 1 === state.currentTeam ? ' current' : '');
      
      const avatar = document.createElement('div');
      avatar.style.fontSize = '2em';
      avatar.style.marginBottom = '8px';
      avatar.textContent = state.teamAvatars[i];
      
      const name = document.createElement('div');
      name.className = 'team-name';
      name.textContent = state.teamNames[i];
      
      const score = document.createElement('div');
      score.className = 'team-score' + (state.teamScores[i] < 0 ? ' negative' : '');
      score.textContent = state.teamScores[i];
      
      const powerups = document.createElement('div');
      powerups.style.fontSize = '0.9em';
      powerups.style.color = '#FFA500';
      powerups.style.marginTop = '8px';
      powerups.textContent = `ğŸ¬${state.teamPowerups[i].candy} ğŸ„${state.teamPowerups[i].ornament}`;
      
      card.appendChild(avatar);
      card.appendChild(name);
      card.appendChild(score);
      card.appendChild(powerups);
      
      container.appendChild(card);
    }
  }

  // ===== TEST FUNCTIONS =====

  // 1. Setup & Initialization
  async function testSDKInit() {
    log('ğŸ”Œ Initializing Data SDK...', 'info');
    
    try {
      const result = await window.dataSdk.init(dataHandler);
      
      if (result.isOk) {
        sdkInitialized = true;
        document.getElementById('sdk-status').textContent = 'âœ… Connected';
        document.getElementById('sdk-status').classList.remove('error');
        log('âœ… SDK initialized successfully', 'success');
        notify('SDK Connected!');
        updateButtonStatus('btn-sdk-init', 'success');
        
        // Try to load existing game state
        setTimeout(() => testLoadGame(), 500);
      } else {
        throw new Error('SDK init returned error');
      }
    } catch (error) {
      log(`âŒ SDK init failed: ${error.message}`, 'error');
      notify('SDK Init Failed!', true);
      updateButtonStatus('btn-sdk-init', 'error');
    }
  }

  async function testCreateGame() {
    log('ğŸ® Creating new game state...', 'info');
    
    if (!sdkInitialized) {
      log('âŒ SDK not initialized!', 'error');
      notify('Initialize SDK first!', true);
      return;
    }
    
    try {
      const initialState = {
        used_questions: '',
        team_scores: '0,0,0,0,0',
        team_names: 'Team 1,Team 2,Team 3,Team 4,Team 5',
        team_avatars: 'ğŸ…,ğŸ¤¶,ğŸ§,â›„,ğŸ„',
        team_powerups: '0-0,0-0,0-0,0-0,0-0',
        current_team: 1,
        next_multiplier: 1,
        daily_doubles: '4,14',
        achievements: 'false,0-0,0-0,0-0-0-0-0',
        buzzer_active: 'false',
        buzzer_winner: '',
        active_question: '',
        answer_revealed: 'false'
      };
      
      const result = await window.dataSdk.create(initialState);
      
      if (result.isOk) {
        log('âœ… Game state created successfully!', 'success');
        notify('Game Created!');
        updateButtonStatus('btn-create-game', 'success');
        
        // Reload to pick up the new state
        setTimeout(() => window.location.reload(), 1000);
      } else {
        throw new Error('Create failed');
      }
    } catch (error) {
      log(`âŒ Create failed: ${error.message}`, 'error');
      notify('Create Failed!', true);
      updateButtonStatus('btn-create-game', 'error');
    }
  }

  async function testLoadGame() {
    log('ğŸ“¥ Loading game state...', 'info');
    
    if (gameState) {
      updateAllDisplays();
      log('âœ… Game state loaded from cache', 'success');
      notify('Game Loaded!');
      updateButtonStatus('btn-load-game', 'success');
    } else {
      log('âš ï¸ No game state available - create one first', 'warning');
      notify('No game state found', true);
      updateButtonStatus('btn-load-game', 'error');
    }
  }

  async function testResetGame() {
    if (!confirm('âš ï¸ DELETE ALL GAME DATA? This cannot be undone!')) return;
    
    log('ğŸ”„ Resetting game (deleting data)...', 'warning');
    
    try {
      if (gameState) {
        const result = await window.dataSdk.delete(gameState);
        if (result.isOk) {
          log('âœ… Game reset successful', 'success');
          notify('Game Reset!');
          gameState = null;
          updateButtonStatus('btn-reset-game', 'success');
          setTimeout(() => window.location.reload(), 1000);
        }
      }
    } catch (error) {
      log(`âŒ Reset failed: ${error.message}`, 'error');
      notify('Reset Failed!', true);
      updateButtonStatus('btn-reset-game', 'error');
    }
  }

  // 2. Team Management
  async function testUpdateName() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    const newName = prompt('Enter new team name:', `Test Team ${teamId}`);
    if (!newName) return;
    
    log(`âœï¸ Updating Team ${teamId} name to "${newName}"...`, 'info');
    
    const state = parseGameState();
    state.teamNames[teamId - 1] = newName;
    
    const success = await updateGameState({
      team_names: state.teamNames.join(',')
    });
    
    if (success) {
      log(`âœ… Team ${teamId} renamed to "${newName}"`, 'success');
      notify(`Team ${teamId} Renamed!`);
      updateButtonStatus('btn-update-name', 'success');
    } else {
      updateButtonStatus('btn-update-name', 'error');
    }
  }

  async function testChangeAvatar() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    const avatars = ['ğŸ…', 'ğŸ¤¶', 'ğŸ§', 'ğŸ§â€â™€ï¸', 'â›„', 'â˜ƒï¸', 'ğŸ¦Œ', 'ğŸ„', 'ğŸ', 'ğŸ””', 'â­', 'â„ï¸', 'ğŸª'];
    const newAvatar = avatars[Math.floor(Math.random() * avatars.length)];
    
    log(`ğŸ¨ Changing Team ${teamId} avatar to ${newAvatar}...`, 'info');
    
    const state = parseGameState();
    state.teamAvatars[teamId - 1] = newAvatar;
    
    const success = await updateGameState({
      team_avatars: state.teamAvatars.join(',')
    });
    
    if (success) {
      log(`âœ… Team ${teamId} avatar changed to ${newAvatar}`, 'success');
      notify(`Avatar Changed: ${newAvatar}`);
      updateButtonStatus('btn-change-avatar', 'success');
    } else {
      updateButtonStatus('btn-change-avatar', 'error');
    }
  }

  async function testSetCurrent() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    
    log(`ğŸ‘‰ Setting Team ${teamId} as current team...`, 'info');
    
    const success = await updateGameState({
      current_team: teamId
    });
    
    if (success) {
      log(`âœ… Current team set to ${teamId}`, 'success');
      notify(`Current Team: ${teamId}`);
      updateButtonStatus('btn-set-current', 'success');
    } else {
      updateButtonStatus('btn-set-current', 'error');
    }
  }

  async function testAddPoints() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    const points = 200;
    
    log(`â• Adding ${points} points to Team ${teamId}...`, 'info');
    
    const state = parseGameState();
    state.teamScores[teamId - 1] += points;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Added ${points} points to Team ${teamId}`, 'success');
      notify(`+${points} Points!`);
      updateButtonStatus('btn-add-points', 'success');
    } else {
      updateButtonStatus('btn-add-points', 'error');
    }
  }

  async function testSubtractPoints() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    const points = 200;
    
    log(`â– Subtracting ${points} points from Team ${teamId}...`, 'info');
    
    const state = parseGameState();
    state.teamScores[teamId - 1] -= points;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Subtracted ${points} points from Team ${teamId}`, 'success');
      notify(`-${points} Points!`);
      updateButtonStatus('btn-subtract-points', 'success');
    } else {
      updateButtonStatus('btn-subtract-points', 'error');
    }
  }

  async function testNegativeScore() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    
    log(`ğŸ“‰ Setting Team ${teamId} to -500...`, 'info');
    
    const state = parseGameState();
    state.teamScores[teamId - 1] = -500;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Team ${teamId} now at -500`, 'success');
      notify('Negative Score Set!');
      updateButtonStatus('btn-negative', 'success');
    } else {
      updateButtonStatus('btn-negative', 'error');
    }
  }

  // 3. Question System
  async function testShowQuestion() {
    const cat = parseInt(document.getElementById('test-category').value);
    const value = parseInt(document.getElementById('test-value').value);
    
    log(`â“ Showing question: Category ${cat}, $${value}...`, 'info');
    
    const questionData = {
      question: `Test question for category ${cat}, value $${value}. All team screens should see this!`,
      answer: `Test answer ${cat}-${value}`,
      value: value,
      isDailyDouble: false
    };
    
    const success = await updateGameState({
      active_question: JSON.stringify(questionData),
      answer_revealed: 'false'
    });
    
    if (success) {
      log('âœ… Question synced to all screens', 'success');
      notify('Question Shown!');
      updateButtonStatus('btn-show-question', 'success');
    } else {
      updateButtonStatus('btn-show-question', 'error');
    }
  }

  async function testRevealAnswer() {
    log('ğŸ‘ï¸ Revealing answer...', 'info');
    
    const success = await updateGameState({
      answer_revealed: 'true'
    });
    
    if (success) {
      log('âœ… Answer revealed to all screens', 'success');
      notify('Answer Revealed!');
      updateButtonStatus('btn-reveal-answer', 'success');
    } else {
      updateButtonStatus('btn-reveal-answer', 'error');
    }
  }

  async function testMarkCorrect() {
    log('âœ… Marking answer correct...', 'info');
    
    const state = parseGameState();
    
    if (!state.activeQuestion) {
      log('âŒ No active question!', 'error');
      notify('No Active Question!', true);
      updateButtonStatus('btn-mark-correct', 'error');
      return;
    }
    
    const questionData = JSON.parse(state.activeQuestion);
    state.teamScores[state.currentTeam - 1] += questionData.value;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(','),
      answer_revealed: 'true'
    });
    
    if (success) {
      log(`âœ… Correct! +${questionData.value} to Team ${state.currentTeam}`, 'success');
      notify(`Correct! +${questionData.value}`);
      updateButtonStatus('btn-mark-correct', 'success');
    } else {
      updateButtonStatus('btn-mark-correct', 'error');
    }
  }

  async function testMarkWrong() {
    log('âŒ Marking answer wrong...', 'info');
    
    const state = parseGameState();
    
    if (!state.activeQuestion) {
      log('âŒ No active question!', 'error');
      notify('No Active Question!', true);
      updateButtonStatus('btn-mark-wrong', 'error');
      return;
    }
    
    const questionData = JSON.parse(state.activeQuestion);
    state.teamScores[state.currentTeam - 1] -= questionData.value;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Wrong! -${questionData.value} from Team ${state.currentTeam}`, 'success');
      notify(`Wrong! -${questionData.value}`);
      updateButtonStatus('btn-mark-wrong', 'success');
    } else {
      updateButtonStatus('btn-mark-wrong', 'error');
    }
  }

  async function testReturnBoard() {
    log('ğŸ”™ Returning to board...', 'info');
    
    const success = await updateGameState({
      active_question: '',
      answer_revealed: 'false'
    });
    
    if (success) {
      log('âœ… Returned to board view', 'success');
      notify('Returned to Board!');
      updateButtonStatus('btn-return-board', 'success');
    } else {
      updateButtonStatus('btn-return-board', 'error');
    }
  }

  async function testUseAllQuestions() {
    log('ğŸ“‹ Marking all questions as used...', 'info');
    
    const allQuestions = Array.from({length: 20}, (_, i) => i).join(',');
    
    const success = await updateGameState({
      used_questions: allQuestions
    });
    
    if (success) {
      log('âœ… All 20 questions marked as used', 'success');
      notify('All Questions Used!');
      updateButtonStatus('btn-use-all', 'success');
    } else {
      updateButtonStatus('btn-use-all', 'error');
    }
  }

  // 4. Multipliers & Power-ups
  async function testDoubleNext() {
    log('âš¡ Activating 2x multiplier...', 'info');
    
    const success = await updateGameState({
      next_multiplier: 2
    });
    
    if (success) {
      log('âœ… Next question will be worth 2x', 'success');
      notify('2x Multiplier Active!');
      updateButtonStatus('btn-double', 'success');
    } else {
      updateButtonStatus('btn-double', 'error');
    }
  }

  async function testTripleNext() {
    log('âš¡ Activating 3x multiplier...', 'info');
    
    const success = await updateGameState({
      next_multiplier: 3
    });
    
    if (success) {
      log('âœ… Next question will be worth 3x', 'success');
      notify('3x Multiplier Active!');
      updateButtonStatus('btn-triple', 'success');
    } else {
      updateButtonStatus('btn-triple', 'error');
    }
  }

  async function testGiveCandy() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    log(`ğŸ¬ Giving candy cane to Team ${teamId}...`, 'info');
    
    const state = parseGameState();
    state.teamPowerups[teamId - 1].candy++;
    
    const success = await updateGameState({
      team_powerups: state.teamPowerups.map(p => `${p.candy}-${p.ornament}`).join(',')
    });
    
    if (success) {
      log(`âœ… Team ${teamId} received candy cane!`, 'success');
      notify('ğŸ¬ Candy Awarded!');
      updateButtonStatus('btn-give-candy', 'success');
    } else {
      updateButtonStatus('btn-give-candy', 'error');
    }
  }

  async function testGiveOrnament() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    log(`ğŸ„ Giving ornament to Team ${teamId}...`, 'info');
    
    const state = parseGameState();
    state.teamPowerups[teamId - 1].ornament++;
    
    const success = await updateGameState({
      team_powerups: state.teamPowerups.map(p => `${p.candy}-${p.ornament}`).join(',')
    });
    
    if (success) {
      log(`âœ… Team ${teamId} received ornament!`, 'success');
      notify('ğŸ„ Ornament Awarded!');
      updateButtonStatus('btn-give-ornament', 'success');
    } else {
      updateButtonStatus('btn-give-ornament', 'error');
    }
  }

  async function testUseCandy() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    log(`ğŸ¬ Using candy for Team ${teamId}...`, 'info');
    
    const state = parseGameState();
    
    if (state.teamPowerups[teamId - 1].candy <= 0) {
      log('âŒ No candy canes available!', 'error');
      notify('No Candy!', true);
      updateButtonStatus('btn-use-candy', 'error');
      return;
    }
    
    state.teamPowerups[teamId - 1].candy--;
    state.teamScores[teamId - 1] += 50;
    
    const success = await updateGameState({
      team_powerups: state.teamPowerups.map(p => `${p.candy}-${p.ornament}`).join(','),
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Team ${teamId} used candy for +50`, 'success');
      notify('ğŸ¬ +50 Points!');
      updateButtonStatus('btn-use-candy', 'success');
    } else {
      updateButtonStatus('btn-use-candy', 'error');
    }
  }

  async function testUseOrnament() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    log(`ğŸ„ Using ornament for Team ${teamId}...`, 'info');
    
    const state = parseGameState();
    
    if (state.teamPowerups[teamId - 1].ornament <= 0) {
      log('âŒ No ornaments available!', 'error');
      notify('No Ornaments!', true);
      updateButtonStatus('btn-use-ornament', 'error');
      return;
    }
    
    state.teamPowerups[teamId - 1].ornament--;
    
    const success = await updateGameState({
      team_powerups: state.teamPowerups.map(p => `${p.candy}-${p.ornament}`).join(','),
      next_multiplier: 2
    });
    
    if (success) {
      log(`âœ… Team ${teamId} activated 2x multiplier!`, 'success');
      notify('ğŸ„ 2x Active!');
      updateButtonStatus('btn-use-ornament', 'success');
    } else {
      updateButtonStatus('btn-use-ornament', 'error');
    }
  }

  // 5. Buzzer System
  async function testEnableBuzzer() {
    log('ğŸ”” Enabling buzzer...', 'info');
    
    const success = await updateGameState({
      buzzer_active: 'true',
      buzzer_winner: ''
    });
    
    if (success) {
      log('âœ… Buzzer enabled for all teams', 'success');
      notify('ğŸ”” Buzzer Active!');
      updateButtonStatus('btn-enable-buzzer', 'success');
    } else {
      updateButtonStatus('btn-enable-buzzer', 'error');
    }
  }

  async function testDisableBuzzer() {
    log('ğŸ”• Disabling buzzer...', 'info');
    
    const success = await updateGameState({
      buzzer_active: 'false'
    });
    
    if (success) {
      log('âœ… Buzzer disabled', 'success');
      notify('ğŸ”• Buzzer Disabled!');
      updateButtonStatus('btn-disable-buzzer', 'success');
    } else {
      updateButtonStatus('btn-disable-buzzer', 'error');
    }
  }

  async function testBuzzIn() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    log(`âš¡ Team ${teamId} buzzing in...`, 'info');
    
    const success = await updateGameState({
      buzzer_active: 'false',
      buzzer_winner: String(teamId)
    });
    
    if (success) {
      log(`âœ… Team ${teamId} buzzed in!`, 'success');
      notify(`ğŸ”” Team ${teamId} Buzzed!`);
      updateButtonStatus('btn-buzz-in', 'success');
    } else {
      updateButtonStatus('btn-buzz-in', 'error');
    }
  }

  async function testClearBuzzer() {
    log('ğŸ§¹ Clearing buzzer state...', 'info');
    
    const success = await updateGameState({
      buzzer_active: 'false',
      buzzer_winner: ''
    });
    
    if (success) {
      log('âœ… Buzzer cleared', 'success');
      notify('Buzzer Cleared!');
      updateButtonStatus('btn-clear-buzzer', 'success');
    } else {
      updateButtonStatus('btn-clear-buzzer', 'error');
    }
  }

  // 6. Chaos Events
  async function testSantaShuffle() {
    log('ğŸ… Santa Shuffle!', 'info');
    
    const state = parseGameState();
    const randomTeam = Math.floor(Math.random() * 5);
    const swings = [100, 200, 300, -100, -200, -300];
    const randomSwing = swings[Math.floor(Math.random() * swings.length)];
    
    state.teamScores[randomTeam] += randomSwing;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Santa gave ${randomSwing > 0 ? '+' : ''}${randomSwing} to Team ${randomTeam + 1}`, 'success');
      notify(`ğŸ… ${randomSwing > 0 ? '+' : ''}${randomSwing}!`);
      updateButtonStatus('btn-santa', 'success');
    } else {
      updateButtonStatus('btn-santa', 'error');
    }
  }

  async function testGingerbread() {
    log('ğŸª Gingerbread Explosion!', 'warning');
    
    const state = parseGameState();
    for (let i = 0; i < 5; i++) {
      state.teamScores[i] -= 100;
    }
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log('âœ… All teams lost 100 points!', 'success');
      notify('ğŸª Everyone -100!');
      updateButtonStatus('btn-gingerbread', 'success');
    } else {
      updateButtonStatus('btn-gingerbread', 'error');
    }
  }

  async function testStockingSteal() {
    log('ğŸ§¦ Stocking Steal!', 'info');
    
    const state = parseGameState();
    
    let lowestIdx = 0, highestIdx = 0;
    let lowestScore = state.teamScores[0];
    let highestScore = state.teamScores[0];
    
    for (let i = 1; i < 5; i++) {
      if (state.teamScores[i] < lowestScore) {
        lowestScore = state.teamScores[i];
        lowestIdx = i;
      }
      if (state.teamScores[i] > highestScore) {
        highestScore = state.teamScores[i];
        highestIdx = i;
      }
    }
    
    if (lowestIdx === highestIdx) {
      log('âš ï¸ All scores equal, nothing to steal', 'warning');
      notify('Scores too close!', true);
      return;
    }
    
    state.teamScores[highestIdx] -= 150;
    state.teamScores[lowestIdx] += 150;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Team ${lowestIdx + 1} stole 150 from Team ${highestIdx + 1}`, 'success');
      notify('ğŸ§¦ Stocking Steal!');
      updateButtonStatus('btn-stocking', 'success');
    } else {
      updateButtonStatus('btn-stocking', 'error');
    }
  }

  async function testSwapScores() {
    const teamId = parseInt(document.getElementById('test-team-select').value);
    const targetId = (teamId % 5) + 1; // Next team
    
    log(`ğŸ”„ Swapping Team ${teamId} and Team ${targetId} scores...`, 'info');
    
    const state = parseGameState();
    const temp = state.teamScores[teamId - 1];
    state.teamScores[teamId - 1] = state.teamScores[targetId - 1];
    state.teamScores[targetId - 1] = temp;
    
    const success = await updateGameState({
      team_scores: state.teamScores.join(',')
    });
    
    if (success) {
      log(`âœ… Scores swapped between Team ${teamId} and ${targetId}`, 'success');
      notify('ğŸ”„ Scores Swapped!');
      updateButtonStatus('btn-swap', 'success');
    } else {
      updateButtonStatus('btn-swap', 'error');
    }
  }

  // 7. Stress Tests
  async function testRapidUpdates() {
    log('âš¡ Starting rapid updates test (10 updates)...', 'info');
    
    const state = parseGameState();
    let successCount = 0;
    
    for (let i = 0; i < 10; i++) {
      const randomTeam = Math.floor(Math.random() * 5);
      const randomPoints = Math.floor(Math.random() * 200) - 100;
      state.teamScores[randomTeam] += randomPoints;
      
      const success = await updateGameState({
        team_scores: state.teamScores.join(',')
      });
      
      if (success) successCount++;
      
      await new Promise(resolve => setTimeout(resolve, 200));
    }
    
    log(`âœ… Rapid updates complete: ${successCount}/10 successful`, 'success');
    notify(`Rapid Updates: ${successCount}/10`);
    updateButtonStatus('btn-rapid', successCount === 10 ? 'success' : 'error');
  }

  async function testAllNegative() {
    log('ğŸ“‰ Setting all teams to negative...', 'info');
    
    const success = await updateGameState({
      team_scores: '-500,-300,-700,-200,-400'
    });
    
    if (success) {
      log('âœ… All teams now negative', 'success');
      notify('All Negative!');
      updateButtonStatus('btn-all-negative', 'success');
    } else {
      updateButtonStatus('btn-all-negative', 'error');
    }
  }

  async function testMaxScores() {
    log('ğŸ“ˆ Setting all teams to max score (9999)...', 'info');
    
    const success = await updateGameState({
      team_scores: '9999,9999,9999,9999,9999'
    });
    
    if (success) {
      log('âœ… All teams at 9999', 'success');
      notify('Max Scores!');
      updateButtonStatus('btn-max-scores', 'success');
    } else {
      updateButtonStatus('btn-max-scores', 'error');
    }
  }

  async function testStateFlood() {
    log('ğŸŒŠ Flooding state changes (20 rapid changes)...', 'warning');
    
    let successCount = 0;
    
    for (let i = 0; i < 20; i++) {
      const success = await updateGameState({
        next_multiplier: (i % 3) + 1,
        current_team: (i % 5) + 1
      });
      
      if (success) successCount++;
      
      await new Promise(resolve => setTimeout(resolve, 100));
    }
    
    log(`âœ… State flood complete: ${successCount}/20 successful`, 'success');
    notify(`Flood Test: ${successCount}/20`);
    updateButtonStatus('btn-flood', successCount === 20 ? 'success' : 'error');
  }

  // ===== INITIALIZATION =====
  window.addEventListener('load', async () => {
    log('ğŸ® Test suite loaded and ready', 'info');
    log('ğŸ‘‰ Click "Initialize SDK" to begin testing', 'info');
  });
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a742a3c736b618d',t:'MTc2NDYwODY4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>